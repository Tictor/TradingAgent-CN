# 火山引擎（字节跳动）集成说明

## 🎉 功能概述

现在TradingAgents-CN已经完全集成火山引擎（字节跳动旗下）作为新的LLM提供商选项。火山引擎完全兼容OpenAI API格式，支持个人创建的专属模型。

## 🚀 新增功能

### 1. Web界面支持
- ✅ 新增"🇨🇳 火山引擎"LLM提供商选项
- ✅ 专门的火山引擎配置界面
- ✅ 自定义模型ID输入框
- ✅ 快速配置按钮和使用提示
- ✅ API密钥状态验证显示

### 2. 后端支持
- ✅ TradingGraph完整集成火山引擎初始化
- ✅ 分析运行器全面支持火山引擎
- ✅ 所有研究深度级别配置适配
- ✅ 环境变量验证和错误处理

### 3. 配置持久化
- ✅ 模型选择自动保存和恢复
- ✅ 会话状态管理
- ✅ URL参数持久化支持

## 📋 使用步骤

### 1. 环境配置

在项目根目录的 `.env` 文件中添加：

```bash
# 火山引擎API密钥
VOLCENGINE_API_KEY=你的火山引擎API密钥

# 其他必需的API密钥
FINNHUB_API_KEY=你的FinnHub密钥
```

### 2. 获取火山引擎API密钥

1. 访问 [火山引擎控制台](https://console.volcengine.com/ark)
2. 登录你的字节跳动账户
3. 进入AI推理服务
4. 创建API密钥
5. 复制API密钥到 `.env` 文件

### 3. 获取个人模型ID

1. 在火山引擎控制台中创建或使用已有的模型
2. 获取你的个人专属模型ID
3. 模型ID格式通常为：`ep-yyyymmdd-xxxxxx`

### 4. Web界面配置

1. 启动Web应用：`python start_web.py`
2. 在左侧边栏的"LLM提供商"中选择"🇨🇳 火山引擎"
3. 在"火山引擎模型ID"输入框中输入你的模型ID
4. 系统会自动验证配置并保存

### 5. 开始分析

配置完成后，就可以像使用其他LLM提供商一样进行股票分析了。

## 🔧 技术细节

### API端点
- **基础URL**: `https://ark.cn-beijing.volces.com/api/v3`
- **协议**: 完全兼容OpenAI API格式
- **认证**: Bearer Token方式

### 支持的功能
- ✅ 所有研究深度级别 (1-5级)
- ✅ 多轮对话和辩论
- ✅ 风险评估
- ✅ 记忆功能
- ✅ 在线数据工具
- ✅ 报告生成和导出

### 模型配置
- **深度思考模型**: 使用你指定的模型ID
- **快速思考模型**: 使用相同的模型ID
- **温度设置**: 0.1 (保证分析的一致性)
- **最大Token**: 2000

## ⚠️ 注意事项

### 1. 模型ID格式
- 火山引擎的模型ID是个人专属的，每个用户都有自己独特的ID
- 不同于GPT-4这样的通用模型名，需要输入你在平台创建的具体模型ID
- 格式示例：`ep-20241201-abc123`

### 2. API密钥安全
- 请妥善保管你的API密钥，不要泄露给他人
- 建议定期更换API密钥
- 不要在代码中硬编码API密钥

### 3. 成本控制
- 火山引擎按使用量收费，请注意控制成本
- 可以通过调整研究深度来控制token使用量
- 建议先用较低的研究深度测试

## 🧪 测试验证

项目中包含了完整的测试套件：

```bash
# 运行火山引擎集成测试
python test_volcengine_simple.py
```

测试覆盖：
- ✅ Web界面配置验证
- ✅ TradingGraph初始化测试
- ✅ 分析运行器配置测试
- ✅ API密钥验证测试
- ✅ 配置持久化测试

## 🚨 故障排除

### 1. API密钥错误
```
错误：使用火山引擎需要设置VOLCENGINE_API_KEY环境变量
解决：检查.env文件中是否正确设置了API密钥
```

### 2. 模型ID无效
```
错误：模型调用失败
解决：确认模型ID格式正确，且在火山引擎控制台中确实存在该模型
```

### 3. 网络连接问题
```
错误：连接超时
解决：检查网络连接，确认能访问火山引擎API端点
```

## 📈 性能优化建议

1. **合理选择研究深度**：根据分析需求选择合适的深度级别
2. **批量分析**：对多只股票可以分批进行，避免频繁API调用
3. **缓存利用**：系统会自动缓存数据，重复分析相同股票会更快

## 🔄 更新说明

### v1.0.0 - 2024年12月
- ✅ 新增火山引擎作为LLM提供商
- ✅ 完整的Web界面集成
- ✅ 自定义模型ID支持
- ✅ 配置持久化功能
- ✅ 全面的测试覆盖

## 💡 使用建议

1. **首次使用**：建议先用1-2级研究深度测试，确认配置正确
2. **模型选择**：选择性能较好的模型以获得更准确的分析结果
3. **成本控制**：定期检查API使用量，根据需要调整分析频率
4. **结果验证**：火山引擎的分析结果仅供参考，请结合其他信息做投资决策

## 🤝 技术支持

如果在使用过程中遇到问题：

1. 首先运行测试脚本检查配置
2. 查看控制台日志了解具体错误信息
3. 检查火山引擎控制台确认模型和API密钥状态
4. 如需更多帮助，请提供详细的错误信息和配置情况

---

🎯 **现在你可以使用火山引擎的强大AI能力进行中文股票分析了！**